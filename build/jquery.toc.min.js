/* Table of Contents jQuery plugin v.0.1.0 https://github.com/alexdesignworks/jquery-toc | License: GPL-2.0 */
!function(e){'use strict';function t(t,r){this.pluginName=n,this.version=i,this.EVENT_HASHCHANGE='hashchange.toc',this.EVENT_PREV='prev.toc',this.EVENT_NEXT='next.toc',this.EVENT_SECTION_SHOWN='shown.toc.section',this.tree=[],this.anchors=[],this.options=e.extend({},{headings:['h2','h3','h4'],pager:!1,levelsCollapsible:[],levelsCollapsed:!1,link:!0,sectionClass:'toc-section-wrap',tocContainerClass:'toc-container',tocAnchorClass:'toc-anchor',tocAnchorPrefix:'toc-anchor-',afterRender:function(e){}},r),this.$element=e(t),this.init()}var n='toc',i='0.1.0';e.extend(t.prototype,{init:function(){var t=this;e(t.options.headings.join(','),t.$element).each(function(){t.addLeaf(e(this))}),t.options.link&&(t.addAnchors(t.tree),t.options.levelsCollapsible.length>0&&(t.wrapAllCollapsed(t.tree),e(window).on(t.EVENT_HASHCHANGE,function(){var e=null,n=t.getCurrentFragment();0===n.length?e=t.getDefaultActiveSection():0===n.indexOf(t.options.tocAnchorPrefix)&&(e=t.findActiveLeaf(n)),e&&t.showSection(e)}))),t.$toc=e(t.renderToc()).insertBefore(t.$element),t.options.afterRender.call(t.$element,t.$toc),t.$element.on(t.EVENT_PREV,function(e,n){var i=n.level||0,r=t.findPrevLeafByFragment(t.getCurrentFragment(),i);r&&t.showSection(r)}),t.$element.on(t.EVENT_NEXT,function(e,n){var i=n.level||0,r=t.findNextLeafByFragment(t.getCurrentFragment(),i);r&&t.showSection(r)}),t.options.levelsCollapsed&&e(window).trigger(t.EVENT_HASHCHANGE)},showSection:function(e){this.getAllSections().hide(),this.getAllSectionsFromLeaf(e).show();var t=this.getTocLinkFromLeaf(e);this.$element.trigger(this.EVENT_SECTION_SHOWN,{contentElement:e.$element,tocLink:t,level:e.level}),this.setCurrentFragment(e.fragment),this.processActiveTocLink(t)},processActiveTocLink:function(e){var t=e.parentsUntil(this.getTocContainer()).filter('li');this.getTocContainer().find('li').not(t).removeClass('active'),t.filter(':not(.active)').addClass('active')},getTocContainer:function(){return this.$element.parent().find('.'+this.options.tocContainerClass)},getTocLinkFromLeaf:function(e){return this.getTocContainer().find('[href="#'+e.fragment+'"]')},getAllSections:function(){return this.$element.find('.'+this.options.sectionClass)},getAllSectionsFromLeaf:function(e){return e.$element.parent('.'+this.options.sectionClass)},findPrevLeafByFragment:function(e,t){var n=null,i=this.findActiveLeaf(e);if(i.level===t){var r=this.findSiblingLeaves(this.tree,i);n=this.getPrevSiblingLeave(r,i)}else for(var s=this.findParentLeaves(this.tree,i),o=0;o<s.length;o++)if(s[o].level===t){var l=this.findSiblingLeaves(this.tree,s[o]);!(n=this.getPrevSiblingLeave(l,s[o]))&&l.length>0&&s[o]===l[0]&&(n=s[o]);break}return n},findNextLeafByFragment:function(e,t){var n=null,i=this.findActiveLeaf(e);if(i.level===t){var r=this.findSiblingLeaves(this.tree,i);n=this.getNextSiblingLeave(r,i)}else for(var s=this.findParentLeaves(this.tree,i),o=0;o<s.length;o++)if(s[o].level===t){var l=this.findSiblingLeaves(this.tree,s[o]);!(n=this.getNextSiblingLeave(l,s[o]))&&l.length>0&&s[o]===l[l.length-1]&&(n=s[o]);break}return n},getNextSiblingLeave:function(e,t){for(var n=0;e[n]!==t&&n<e.length;)n++;return n+1<e.length?e[n+1]:null},getPrevSiblingLeave:function(e,t){for(var n=0;e[n]!==t&&n<e.length;)n++;return n-1>=0?e[n-1]:null},findParentLeaves:function(t,n){for(var i=[],r=0;r<t.length;r++)for(var s=0;s<t[r].children.length;s++)t[r].children[s]===n&&i.push(t[r]),e.merge(i,this.findParentLeaves(t[r].children[s].children,n));return i},findSiblingLeaves:function(e,t){for(var n=0;n<e.length;n++){if(e[n]===t)return e;var i=this.findSiblingLeaves(e[n].children,t);if(i.length>0)return i}return[]},findActiveLeaf:function(e){var t=this.treeToList(this.tree).filter(function(t){return t.fragment===e});return t.length>0?t.pop():null},getDefaultActiveSection:function(){return this.tree.length>0?this.tree[0]:null},getCurrentFragment:function(){return window.location.hash.substr(1)},setCurrentFragment:function(e){e.indexOf('#')>=0&&(e=e.substr(e.indexOf('#')+1)),history.replaceState?(history.scrollRestoration='manual',history.replaceState(null,null,'#'+e)):window.location.hash=e},treeToList:function(t){for(var n=[],i=0;i<t.length;i++)n.push(t[i]),t[i].children.length>0&&e.merge(n,this.treeToList(t[i].children));return n},addLeaf:function(t,n){n=n||this.getLevel(t);for(var i=0,r=this.tree;i<n;)0===r.length&&r.push({$element:e(),level:i,children:[]}),r=r[r.length-1].children,i++;r.push({$element:t,level:n,children:[]})},getLevel:function(e){for(var t in this.options.headings)if(e.is(this.options.headings[t]))return parseInt(t);throw'Unable to get level for provided element'},addAnchors:function(e){for(var t=0;t<e.length;t++)e[t].fragment=this.generateAnchor(e[t].$element.text()),this.renderAnchor(e[t]),e[t].children.length>0&&this.addAnchors(e[t].children)},generateAnchor:function(e){for(var t=this.options.tocAnchorPrefix+e.toLowerCase().replace(/[^a-z0-9]/,'').replace(/ /g,'-'),n=t,i=2;this.anchors.indexOf(n)>-1;)n=t+'-'+i,i++;return this.anchors.push(n),n},wrapAllCollapsed:function(e){for(var t=this,n=t.treeToList(e).filter(function(e){return t.options.levelsCollapsible.indexOf(e.level)>-1}),i=0;i<n.length;i++){var r=i<n.length-1?n[i+1].$element:null,s=n[i].$element.nextUntil(r);s=s.add(n[i].$element),t.renderSectionWrap(s,n[i].level)}},renderTree:function(e){for(var t='<ul>',n=0;n<e.length;n++){var i='';e[n].children.length>0&&(i=this.renderTree(e[n].children));var r={isFirst:0===n,isLast:n===e.length-1,suffix:i};t+=this.renderLeaf(e[n],r)}return t+='</ul>'},renderLeaf:function(e,t){var n='';e.$element.length>0&&(n+=e.$element.text(),this.options.link&&(n='<a href="#'+e.fragment+'">'+n+'</a>'));var i=[];return t.isFirst&&i.push('first'),t.isLast&&i.push('last'),'<li class="'+i.join(' ')+'">'+n+t.suffix+'</li>'},renderAnchor:function(e){e.$element.prepend('<a class="'+this.options.tocAnchorClass+'" id="'+e.fragment+'"></a>')},renderSectionWrap:function(e,t){e.wrapAll('<div class="'+this.options.sectionClass+' level-'+t+'"></div>')},renderToc:function(){var e='<div class="'+this.options.tocContainerClass+'">';return e+=this.renderTree(this.tree),e+='</div>'}}),e.fn[n]=function(i){return this.each(function(){e.data(this,'plugin_'+n)||e.data(this,'plugin_'+n,new t(this,i))})}}(jQuery);