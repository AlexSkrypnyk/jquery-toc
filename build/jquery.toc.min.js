/* Table of Contents jQuery plugin v.0.1.0 https://github.com/alexdesignworks/jquery-toc | License: GPL-2.0 */
!function(e){'use strict';function t(t,r){this.pluginName=n,this.version=i,this.EVENT_HASHCHANGE='hashchange.toc',this.EVENT_PREV='prev.toc',this.EVENT_NEXT='next.toc',this.EVENT_SECTION_SHOWN='shown.toc.section',this.tree=[],this.anchors=[],this.options=e.extend({},{headings:['h2','h3','h4'],pager:!1,levelsCollapsible:[],levelsCollapsed:!1,link:!0,sectionClass:'toc-section-wrap',tocContainerClass:'toc-container'},r),this.$element=e(t),this.init()}var n='toc',i='0.1.0';e.extend(t.prototype,{init:function(){var t=this;e(t.options.headings.join(','),t.$element).each(function(){t.addLeaf(e(this))}),t.options.link&&(t.addAnchors(t.tree),t.options.levelsCollapsible.length>0&&(t.wrapAllCollapsed(t.tree),e(window).on(t.EVENT_HASHCHANGE,function(){var e=t.findActiveLeaf(t.getCurrentFragment());(e=e||t.getDefaultActiveSection())&&t.showSection(e)}))),t.$toc=t.renderToc(),t.$element.before(t.$toc),t.$element.on(t.EVENT_PREV,function(e,n){var i=n.level||0,r=t.findPrevLeafByFragment(t.getCurrentFragment(),i);r&&t.showSection(r)}),t.$element.on(t.EVENT_NEXT,function(e,n){var i=n.level||0,r=t.findNextLeafByFragment(t.getCurrentFragment(),i);r&&t.showSection(r)}),t.options.levelsCollapsed&&e(window).trigger(t.EVENT_HASHCHANGE)},showSection:function(e){this.getAllSections().hide(),this.getAllSectionsFromLeaf(e).show();var t=this.getTocLinkFromLeaf(e);this.$element.trigger(this.EVENT_SECTION_SHOWN,{contentElement:e.$element,tocLink:t}),this.setCurrentFragment(e.fragment),this.processActiveTocLink(t)},processActiveTocLink:function(e){var t=e.parentsUntil(this.getTocContainer()).filter('li');this.getTocContainer().find('li').not(t).removeClass('active'),t.filter(':not(.active)').addClass('active')},getTocContainer:function(){return this.$element.parent().find('.'+this.options.tocContainerClass)},getTocLinkFromLeaf:function(e){return this.getTocContainer().find('[href="#'+e.fragment+'"]')},getAllSections:function(){return this.$element.find('.'+this.options.sectionClass)},getAllSectionsFromLeaf:function(e){return e.$element.parent('.'+this.options.sectionClass)},findNextLeafByFragment:function(e,t){for(var n=this.treeToList(this.tree).filter(function(e){return e.level===t}),i=0;i<n.length;i++)if(n[i].fragment===e&&i+1<n.length)return n[i+1];return null},findPrevLeafByFragment:function(e,t){for(var n=this.treeToList(this.tree).filter(function(e){return e.level===t}),i=0;i<n.length;i++)if(n[i].fragment===e&&i-1>=0)return n[i-1];return null},findActiveLeaf:function(e){var t=this.treeToList(this.tree).filter(function(t){return t.fragment===e});return t.length>0?t.pop():null},getDefaultActiveSection:function(){return this.tree.length>0?this.tree[0]:null},getCurrentFragment:function(){return window.location.hash.substr(1)},setCurrentFragment:function(e){e.indexOf('#')>=0&&(e=e.substr(e.indexOf('#')+1)),window.location.hash=e},treeToList:function(t){for(var n=[],i=0;i<t.length;i++)n.push(t[i]),t[i].children.length>0&&e.merge(n,this.treeToList(t[i].children));return n},addLeaf:function(e,t){t=t||this.getLevel(e);for(var n=0,i=this.tree;n<t;){var r=Math.max(i.length-1,0),o=[{$element:null,children:[]}];i[r].children=i[r].children||o,i=i[r].children,n++}i.push({$element:e,level:t,children:[]})},getLevel:function(e){for(var t in this.options.headings)if(e.is(this.options.headings[t]))return parseInt(t);throw'Unable to get level for provided element'},addAnchors:function(e){for(var t=0;t<e.length;t++)e[t].fragment=this.generateAnchor(e[t].$element.text()),this.renderAnchor(e[t]),e[t].children.length>0&&this.addAnchors(e[t].children)},generateAnchor:function(e){for(var t=e.toLowerCase().replace(/ /g,'-'),n=t,i=2;this.anchors.indexOf(n)>-1;)n=t+'-'+i,i++;return this.anchors.push(n),n},wrapAllCollapsed:function(e){for(var t=this,n=t.treeToList(e).filter(function(e){return t.options.levelsCollapsible.indexOf(e.level)>-1}),i=0;i<n.length;i++){var r=i<n.length-1?n[i+1].$element:null,o=n[i].$element.nextUntil(r);o=o.add(n[i].$element),t.renderSectionWrap(o,n[i].level)}},renderTree:function(e){for(var t='<ul>',n=0;n<e.length;n++){var i='';e[n].children.length>0&&(i=this.renderTree(e[n].children));var r={isFirst:0===n,isLast:n===e.length-1,suffix:i};t+=this.renderLeaf(e[n],r)}return t+='</ul>'},renderLeaf:function(e,t){var n=e.$element.text();this.options.link&&(n='<a href="#'+e.fragment+'">'+n+'</a>');var i=[];return t.isFirst&&i.push('first'),t.isLast&&i.push('last'),'<li class="'+i.join(' ')+'">'+n+t.suffix+'</li>'},renderAnchor:function(e){e.$element.prepend('<a id="'+e.fragment+'"></a>')},renderSectionWrap:function(e,t){e.wrapAll('<div class="'+this.options.sectionClass+' level-'+t+'"></div>')},renderToc:function(){var e='<div class="'+this.options.tocContainerClass+'">';return e+=this.renderTree(this.tree),e+='</div>'}}),e.fn[n]=function(i){return this.each(function(){e.data(this,'plugin_'+n)||e.data(this,'plugin_'+n,new t(this,i))})}}(jQuery);